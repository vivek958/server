<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="theme-color" content="#ff69b4" />
  <title>üíù Interactive Valentine Game</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/canvas-confetti/1.6.0/confetti.browser.min.js"></script>
  <style>
    /* Modern CSS Reset */
    *, *::before, *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    /* Base styles with improved mobile support */
    body {
      margin: 0;
      padding: 0;
      min-height: 100vh;
      min-height: -webkit-fill-available;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #f5576c 75%, #ffd36e 100%);
      background-size: 400% 400%;
      animation: gradientShift 15s ease infinite;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      overflow-x: hidden;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      position: relative;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    @keyframes gradientShift {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }

    /* Floating hearts background */
    .parallax {
      position: fixed;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 0;
      overflow: hidden;
    }

    .bg-element {
      position: absolute;
      font-size: clamp(20px, 4vw, 32px);
      animation: float 12s infinite ease-in-out;
      opacity: 0.7;
      filter: drop-shadow(0 0 10px rgba(255, 105, 180, 0.5));
      will-change: transform;
    }

    @keyframes float {
      0% { 
        transform: translateY(100vh) rotate(0deg) scale(0.8);
        opacity: 0;
      }
      10% {
        opacity: 0.7;
      }
      90% {
        opacity: 0.7;
      }
      100% { 
        transform: translateY(-120px) rotate(720deg) scale(1.2);
        opacity: 0;
      }
    }

    /* Main container with glassmorphism */
    .container {
      max-width: 600px;
      width: 90%;
      margin: 20px;
      padding: clamp(20px, 5vw, 40px);
      text-align: center;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-radius: 25px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3), 
                  0 0 100px rgba(255, 105, 180, 0.2);
      z-index: 10;
      position: relative;
      animation: slideIn 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
      border: 2px solid rgba(255, 255, 255, 0.3);
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(50px) scale(0.9);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    h1, h2 {
      color: #ff1493;
      margin-bottom: 20px;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
      animation: pulse 2s ease-in-out infinite;
    }

    h1 {
      font-size: clamp(1.5rem, 5vw, 2.5rem);
    }

    h2 {
      font-size: clamp(1.2rem, 4vw, 2rem);
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    /* Enhanced input field */
    input {
      padding: 15px 20px;
      font-size: clamp(14px, 3vw, 18px);
      border: 3px solid #ff69b4;
      border-radius: 15px;
      margin: 15px 0;
      width: 100%;
      max-width: 400px;
      transition: all 0.3s ease;
      outline: none;
      background: rgba(255, 255, 255, 0.9);
    }

    input:focus {
      border-color: #ff1493;
      box-shadow: 0 0 20px rgba(255, 20, 147, 0.4);
      transform: scale(1.02);
    }

    /* Enhanced buttons */
    button {
      padding: 15px 30px;
      font-size: clamp(14px, 3vw, 18px);
      background: linear-gradient(135deg, #ff6b9d 0%, #c06c84 100%);
      border: none;
      border-radius: 15px;
      color: white;
      cursor: pointer;
      margin: 10px;
      transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      box-shadow: 0 5px 15px rgba(255, 105, 180, 0.4);
      font-weight: bold;
      min-width: 120px;
      position: relative;
      overflow: hidden;
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
    }

    button::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.5);
      transform: translate(-50%, -50%);
      transition: width 0.6s, height 0.6s;
    }

    button:active::before {
      width: 300px;
      height: 300px;
    }

    button:hover {
      transform: translateY(-3px) scale(1.05);
      box-shadow: 0 10px 25px rgba(255, 105, 180, 0.6);
    }

    button:active {
      transform: translateY(-1px) scale(1.02);
    }

    /* Special styling for Yes button */
    .yes-button {
      background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
      box-shadow: 0 5px 15px rgba(56, 239, 125, 0.4);
    }

    .yes-button:hover {
      box-shadow: 0 10px 25px rgba(56, 239, 125, 0.6);
    }

    /* Evasive No button */
    .no-button {
      background: linear-gradient(135deg, #ee0979 0%, #ff6a00 100%);
      transition: all 0.2s ease;
    }

    /* Modal styling with blur */
    .modal {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0.8);
      background: white;
      padding: clamp(20px, 5vw, 40px);
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      z-index: 1000;
      text-align: center;
      max-width: 90%;
      animation: modalIn 0.3s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
    }

    @keyframes modalIn {
      to {
        transform: translate(-50%, -50%) scale(1);
      }
    }

    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      z-index: 900;
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    /* Loading screen with progress */
    .loading-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 2000;
      animation: fadeOut 0.5s ease 2s forwards;
    }

    @keyframes fadeOut {
      to {
        opacity: 0;
        pointer-events: none;
      }
    }

    .spinner {
      width: 60px;
      height: 60px;
      border: 6px solid rgba(255, 255, 255, 0.3);
      border-top: 6px solid white;
      border-radius: 50%;
      animation: spin 1s cubic-bezier(0.68, -0.55, 0.265, 1.55) infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .loading-text {
      color: white;
      font-size: clamp(1rem, 4vw, 1.5rem);
      margin-top: 20px;
      font-weight: bold;
      animation: textPulse 1.5s ease-in-out infinite;
    }

    @keyframes textPulse {
      0%, 100% { opacity: 0.6; }
      50% { opacity: 1; }
    }

    /* Progress bar */
    .progress-bar {
      width: 80%;
      max-width: 400px;
      height: 6px;
      background: rgba(255, 255, 255, 0.3);
      border-radius: 10px;
      margin-top: 30px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #38ef7d, #11998e);
      border-radius: 10px;
      animation: progressLoad 2s ease forwards;
    }

    @keyframes progressLoad {
      from { width: 0%; }
      to { width: 100%; }
    }

    /* Buffering screen */
    .buffering-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.85);
      backdrop-filter: blur(10px);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 1500;
      color: white;
      font-size: clamp(1rem, 4vw, 1.5rem);
      animation: fadeIn 0.3s ease;
    }

    .buffering-spinner {
      width: 70px;
      height: 70px;
      border: 8px solid rgba(255, 255, 255, 0.2);
      border-top: 8px solid white;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin-bottom: 20px;
    }

    /* Error overlay with shake animation */
    .error-text {
      color: #ff1744;
      font-weight: bold;
      font-size: clamp(1.2rem, 5vw, 2rem);
      text-align: center;
      background: white;
      padding: clamp(20px, 5vw, 40px);
      border-radius: 20px;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 1600;
      box-shadow: 0 20px 60px rgba(255, 23, 68, 0.4);
      animation: shake 0.5s ease, fadeIn 0.3s ease;
      border: 3px solid #ff1744;
      max-width: 90%;
    }

    @keyframes shake {
      0%, 100% { transform: translate(-50%, -50%) rotate(0deg); }
      25% { transform: translate(-48%, -50%) rotate(-5deg); }
      75% { transform: translate(-52%, -50%) rotate(5deg); }
    }

    /* Success screen enhanced */
    .success-screen {
      text-align: center;
      font-size: clamp(1rem, 4vw, 1.5rem);
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(255, 255, 255, 0.98);
      backdrop-filter: blur(20px);
      padding: clamp(30px, 6vw, 50px);
      border-radius: 25px;
      box-shadow: 0 30px 80px rgba(0, 0, 0, 0.3);
      z-index: 1700;
      max-width: 90%;
      animation: successPop 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
      border: 3px solid #38ef7d;
    }

    @keyframes successPop {
      0% {
        transform: translate(-50%, -50%) scale(0.3);
        opacity: 0;
      }
      100% {
        transform: translate(-50%, -50%) scale(1);
        opacity: 1;
      }
    }

    .success-gif {
      max-width: 80%;
      max-height: 300px;
      margin-top: 20px;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    }

    /* Audio controls with better mobile support */
    #audio-controls {
      position: fixed;
      bottom: 20px;
      left: 20px;
      z-index: 100;
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(10px);
      border-radius: 50%;
      width: 60px;
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      transition: all 0.3s ease;
    }

    #audio-controls:hover {
      transform: scale(1.1);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
    }

    #audio-controls button {
      background: transparent;
      box-shadow: none;
      margin: 0;
      padding: 0;
      font-size: 24px;
      min-width: auto;
    }

    /* Spawned No buttons with random colors */
    .spawned-no {
      position: fixed !important;
      z-index: 1400 !important;
      animation: spawnIn 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    @keyframes spawnIn {
      from {
        transform: scale(0) rotate(-180deg);
        opacity: 0;
      }
      to {
        transform: scale(1) rotate(0deg);
        opacity: 1;
      }
    }

    /* Fade transitions */
    .fade-out {
      animation: fadeOutAnim 0.5s ease forwards;
    }

    @keyframes fadeOutAnim {
      to {
        opacity: 0;
        transform: scale(0.8);
      }
    }

    /* Level screens */
    .level-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.9);
      backdrop-filter: blur(15px);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 1800;
      padding: 20px;
    }

    .level-content {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      padding: clamp(30px, 6vw, 50px);
      border-radius: 25px;
      max-width: 90%;
      max-height: 85vh;
      overflow-y: auto;
      box-shadow: 0 30px 80px rgba(0, 0, 0, 0.4);
      animation: successPop 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    .level-title {
      font-size: clamp(1.5rem, 5vw, 2.5rem);
      color: #ff1493;
      margin-bottom: 20px;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
    }

    .level-description {
      font-size: clamp(1rem, 3vw, 1.3rem);
      color: #333;
      margin-bottom: 30px;
    }

    /* Button grid for Level 1 */
    .button-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
      gap: 10px;
      margin-top: 20px;
      max-width: 800px;
    }

    .grid-button {
      padding: 12px 20px;
      min-width: auto;
      margin: 0;
      font-size: clamp(12px, 2.5vw, 16px);
    }

    /* Moving buttons for Level 2 */
    .moving-button {
      position: fixed !important;
      animation: moveRandom 3s ease-in-out infinite;
      z-index: 1850 !important;
    }

    @keyframes moveRandom {
      0%, 100% { transform: translate(0, 0); }
      25% { transform: translate(var(--dx1), var(--dy1)); }
      50% { transform: translate(var(--dx2), var(--dy2)); }
      75% { transform: translate(var(--dx3), var(--dy3)); }
    }

    /* Speed buttons for Level 3 */
    .speed-button {
      animation: speedFade 2s ease-in-out;
    }

    @keyframes speedFade {
      0%, 80% { opacity: 1; }
      100% { opacity: 0.3; }
    }

    /* Attempt counter */
    .attempt-counter {
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(10px);
      padding: 10px 20px;
      border-radius: 15px;
      font-weight: bold;
      color: #ff1493;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      z-index: 100;
      animation: slideInRight 0.5s ease;
    }

    @keyframes slideInRight {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    /* Level indicator */
    .level-indicator {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(10px);
      padding: 10px 25px;
      border-radius: 15px;
      font-weight: bold;
      color: #ff1493;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      z-index: 100;
      animation: slideInDown 0.5s ease;
    }

    @keyframes slideInDown {
      from {
        transform: translate(-50%, -100%);
        opacity: 0;
      }
      to {
        transform: translate(-50%, 0);
        opacity: 1;
      }
    }

    /* Shake device prompt */
    .shake-prompt {
      position: fixed;
      bottom: 100px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      padding: 15px 25px;
      border-radius: 15px;
      font-size: 14px;
      color: #ff1493;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      z-index: 100;
      animation: bounce 2s ease-in-out infinite;
    }

    @keyframes bounce {
      0%, 100% { transform: translateX(-50%) translateY(0); }
      50% { transform: translateX(-50%) translateY(-10px); }
    }

    /* Particle effect container */
    #particles {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 5;
    }

    .particle {
      position: absolute;
      width: 10px;
      height: 10px;
      background: radial-gradient(circle, #ff69b4, transparent);
      border-radius: 50%;
      pointer-events: none;
      animation: particleFade 2s ease-out forwards;
    }

    @keyframes particleFade {
      0% {
        opacity: 1;
        transform: translate(0, 0) scale(1);
      }
      100% {
        opacity: 0;
        transform: translate(var(--tx), var(--ty)) scale(0);
      }
    }

    /* Mobile optimizations */
    @media (max-width: 768px) {
      .container {
        width: 95%;
        margin: 10px;
      }

      button {
        padding: 12px 24px;
        margin: 8px;
        min-width: 100px;
      }

      #audio-controls {
        bottom: 15px;
        left: 15px;
        width: 50px;
        height: 50px;
      }

      #audio-controls button {
        font-size: 20px;
      }

      .button-grid {
        grid-template-columns: repeat(auto-fit, minmax(60px, 1fr));
        gap: 8px;
      }

      .grid-button {
        padding: 10px 15px;
      }
    }

    /* Accessibility improvements */
    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
    }
  </style>
</head>
<body>
  <!-- Parallax background -->
  <div class="parallax" id="parallax"></div>
  
  <!-- Particle effect container -->
  <div id="particles"></div>
  
  <!-- Initial loading screen with progress -->
  <div class="loading-screen" id="initial-loading">
    <div class="spinner"></div>
    <div class="loading-text">Loading Valentine Magic...</div>
    <div class="progress-bar">
      <div class="progress-fill"></div>
    </div>
  </div>
  
  <!-- Main content container -->
  <div class="container" id="main-content" style="display: none;">
    <div id="name-input">
      <h2>üíñ Please Enter Your Name üíñ</h2>
      <input type="text" id="name" placeholder="Your name here..." required />
      <button onclick="submitName()">‚ú® Submit</button>
    </div>
    <div id="valentine-question" style="display: none;">
      <h1>üíù Will You Be My Valentine? üíù</h1>
      <div id="button-container">
        <button class="yes-button" onclick="answer(true)">üíö Yes</button>
        <button class="no-button" id="no-btn" onclick="answer(false)">üíî No</button>
      </div>
    </div>
  </div>
  
  <!-- Attempt counter -->
  <div class="attempt-counter" id="attempt-counter" style="display: none;">
    Attempts: <span id="attempt-count">0</span>/5
  </div>

  <!-- Level indicator -->
  <div class="level-indicator" id="level-indicator" style="display: none;">
    Level: <span id="level-number">0</span>
  </div>
  
  <!-- Shake prompt for mobile -->
  <div class="shake-prompt" id="shake-prompt" style="display: none;">
    üì± Shake your device if stuck!
  </div>
  
  <!-- Audio toggle button -->
  <div id="audio-controls">
    <button onclick="toggleMusic()" id="music-btn">üîä</button>
  </div>

  <script>
    // Configuration and state
    let userName = '';
    let noAttempts = 0;
    let currentLevel = 0;
    let isMusicPlaying = false;
    let audioInitialized = false;
    let mouseMoveEnabled = false;
    let shakeDetectionEnabled = false;

    const parallax = document.getElementById('parallax');
    const bgElements = ['üíñ', 'üíù', 'üíï', 'üíó', 'üíì', 'üíû', 'üíò', 'üå∏', '‚ú®', 'üéÄ', 'üåπ'];
    const bgColors = ['#ff69b4', '#ff1493', '#ff8da1', '#ffc0cb', '#ff69b4'];
    
    const noButton = document.getElementById('no-btn');
    const attemptCounter = document.getElementById('attempt-counter');
    const attemptCount = document.getElementById('attempt-count');
    const shakePrompt = document.getElementById('shake-prompt');
    const levelIndicator = document.getElementById('level-indicator');
    const levelNumber = document.getElementById('level-number');

    // Audio setup
    const backgroundMusic = new Audio('bg.mp3');
    backgroundMusic.loop = true;
    backgroundMusic.volume = 0.5;

    // Initialize audio on first interaction
    function initAudio() {
      if (!audioInitialized) {
        backgroundMusic.play().then(() => {
          isMusicPlaying = true;
          document.getElementById('music-btn').textContent = 'üîä';
        }).catch(err => console.log('Audio play failed:', err));
        audioInitialized = true;
        document.body.removeEventListener('click', initAudio);
        document.body.removeEventListener('touchstart', initAudio);
      }
    }
    
    document.body.addEventListener('click', initAudio);
    document.body.addEventListener('touchstart', initAudio);

    // Create enhanced parallax background
    for (let i = 0; i < 40; i++) {
      const el = document.createElement('div');
      el.className = 'bg-element';
      el.style.left = `${Math.random() * 100}%`;
      el.style.top = `${Math.random() * 100}%`;
      el.style.animationDelay = `${Math.random() * 12}s`;
      el.style.animationDuration = `${8 + Math.random() * 8}s`;
      el.style.color = bgColors[Math.floor(Math.random() * bgColors.length)];
      el.innerText = bgElements[Math.floor(Math.random() * bgElements.length)];
      parallax.appendChild(el);
    }

    // Hide loading screen and show main content
    setTimeout(() => {
      document.getElementById('initial-loading').style.display = 'none';
      document.getElementById('main-content').style.display = 'block';
    }, 2500);

    // Create particles effect
    function createParticles(x, y, count = 15) {
      const container = document.getElementById('particles');
      for (let i = 0; i < count; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';
        particle.style.left = x + 'px';
        particle.style.top = y + 'px';
        particle.style.setProperty('--tx', `${(Math.random() - 0.5) * 200}px`);
        particle.style.setProperty('--ty', `${(Math.random() - 0.5) * 200}px`);
        container.appendChild(particle);
        setTimeout(() => particle.remove(), 2000);
      }
    }

    // Enhanced confetti
    function launchConfetti() {
      const duration = 3000;
      const end = Date.now() + duration;

      const interval = setInterval(() => {
        if (Date.now() > end) {
          clearInterval(interval);
          return;
        }

        confetti({
          particleCount: 3,
          angle: 60,
          spread: 55,
          origin: { x: 0 },
          colors: ['#ff69b4', '#ff1493', '#ffc0cb', '#ff8da1']
        });
        confetti({
          particleCount: 3,
          angle: 120,
          spread: 55,
          origin: { x: 1 },
          colors: ['#ff69b4', '#ff1493', '#ffc0cb', '#ff8da1']
        });
      }, 50);
    }

    // Name submission
    function submitName() {
      const nameInput = document.getElementById('name');
      if (nameInput.value.trim() === '') {
        nameInput.style.animation = 'shake 0.5s ease';
        setTimeout(() => nameInput.style.animation = '', 500);
        alert('üíñ Please enter your name!');
        return;
      }
      userName = nameInput.value.trim();
      createConfirmModal();
    }

    // Create confirmation modal
    function createConfirmModal() {
      const modal = document.createElement('div');
      modal.className = 'modal';
      modal.innerHTML = `
        <h3>üí≠ Just checking...</h3>
        <p>Is "${userName}" your real name?</p>
        <button onclick="confirmName(true)" class="yes-button">‚úÖ Yes</button>
        <button onclick="confirmName(false)" class="no-button">‚ùå No</button>
      `;
      const overlay = document.createElement('div');
      overlay.className = 'overlay';
      overlay.onclick = () => confirmName(false);
      document.body.appendChild(overlay);
      document.body.appendChild(modal);
    }

    // Confirm name
    function confirmName(isReal) {
      const modal = document.querySelector('.modal');
      const overlay = document.querySelector('.overlay');
      
      if (modal) {
        modal.classList.add('fade-out');
        overlay.classList.add('fade-out');
        setTimeout(() => {
          modal?.remove();
          overlay?.remove();
        }, 500);
      }

      if (isReal) {
        document.getElementById('name-input').style.display = 'none';
        document.getElementById('valentine-question').style.display = 'block';
        attemptCounter.style.display = 'block';
        levelIndicator.style.display = 'block';
        enableNoButtonEvasion();
        
        // Show shake prompt on mobile after 5 seconds
        if (window.innerWidth <= 768) {
          setTimeout(() => {
            shakePrompt.style.display = 'block';
            enableShakeDetection();
          }, 5000);
        }
      } else {
        document.getElementById('name').value = '';
        document.getElementById('name').focus();
      }
    }

    // Enable No button evasion on hover/touch
    function enableNoButtonEvasion() {
      // Mouse hover evasion
      noButton.addEventListener('mouseenter', () => {
        if (noAttempts < 5) {
          moveNoButton();
        }
      });

      // Touch move evasion
      noButton.addEventListener('touchstart', (e) => {
        if (noAttempts < 5) {
          e.preventDefault();
          moveNoButton();
        }
      });
    }

    // Move No button to random position
    function moveNoButton() {
      const maxX = window.innerWidth - noButton.offsetWidth - 40;
      const maxY = window.innerHeight - noButton.offsetHeight - 40;
      const randomX = Math.random() * maxX;
      const randomY = Math.random() * maxY;
      
      noButton.style.position = 'fixed';
      noButton.style.left = randomX + 'px';
      noButton.style.top = randomY + 'px';
      noButton.style.transform = 'scale(0.9)';
      
      setTimeout(() => {
        noButton.style.transform = 'scale(1)';
      }, 200);

      createParticles(randomX + noButton.offsetWidth / 2, randomY + noButton.offsetHeight / 2, 8);
    }

    // Answer handler
    function answer(isYes) {
      if (isYes) {
        showSuccess();
      } else {
        noAttempts++;
        attemptCount.textContent = noAttempts;
        playErrorSound();
        
        if (noAttempts >= 5) {
          // Start Level 1 after 5 attempts
          removeAllSpawnedButtons();
          showTransitionScreen();
        } else {
          spawnNoButton();
        }
      }
    }

    // Play error sound
    function playErrorSound() {
      const errorSound = new Audio('error.mp3');
      errorSound.volume = 0.7;
      errorSound.play().catch(err => console.log('Error sound failed:', err));
    }

    // Spawn floating No buttons
    function spawnNoButton() {
      const btn = document.createElement('button');
      btn.innerText = 'üíî No';
      btn.className = 'spawned-no no-button';
      
      const x = Math.random() * (window.innerWidth - 120);
      const y = Math.random() * (window.innerHeight - 60);
      
      btn.style.left = x + 'px';
      btn.style.top = y + 'px';
      
      // Random gradient for visual variety
      const gradients = [
        'linear-gradient(135deg, #ee0979 0%, #ff6a00 100%)',
        'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)',
        'linear-gradient(135deg, #fa709a 0%, #fee140 100%)'
      ];
      btn.style.background = gradients[Math.floor(Math.random() * gradients.length)];
      
      btn.onclick = () => {
        noAttempts++;
        attemptCount.textContent = noAttempts;
        playErrorSound();
        btn.classList.add('fade-out');
        createParticles(x + 60, y + 30, 10);
        setTimeout(() => btn.remove(), 500);
        
        if (noAttempts >= 5) {
          removeAllSpawnedButtons();
          showTransitionScreen();
        }
      };
      
      document.body.appendChild(btn);
      createParticles(x + 60, y + 30, 8);
      
      // Auto-remove after 5 seconds
      setTimeout(() => {
        if (document.body.contains(btn)) {
          btn.classList.add('fade-out');
          setTimeout(() => btn.remove(), 500);
        }
      }, 5000);
    }

    // Remove all spawned buttons
    function removeAllSpawnedButtons() {
      document.querySelectorAll('.spawned-no').forEach(btn => {
        btn.classList.add('fade-out');
        setTimeout(() => btn.remove(), 500);
      });
    }

    // Show transition screen between levels
    function showTransitionScreen() {
      const transition = document.createElement('div');
      transition.className = 'buffering-screen';
      transition.innerHTML = `
        <div class="buffering-spinner"></div>
        <div>üòº Unlocking next level...</div>
      `;
      document.body.appendChild(transition);
      
      setTimeout(() => {
        transition.classList.add('fade-out');
        setTimeout(() => {
          transition.remove();
          currentLevel++;
          levelNumber.textContent = currentLevel;
          startLevel(currentLevel);
        }, 500);
      }, 2000);
    }

    // Start specific level
    function startLevel(level) {
      // Hide main content
      document.getElementById('main-content').style.display = 'none';
      attemptCounter.style.display = 'none';
      shakePrompt.style.display = 'none';

      switch(level) {
        case 1:
          startLevel1();
          break;
        case 2:
          startLevel2();
          break;
        case 3:
          startLevel3();
          break;
      }
    }

    // Level 1: Find the No among Yes buttons
    function startLevel1() {
      const levelScreen = document.createElement('div');
      levelScreen.className = 'level-screen';
      levelScreen.id = 'level1-screen';
      
      const content = document.createElement('div');
      content.className = 'level-content';
      
      const title = document.createElement('h2');
      title.className = 'level-title';
      title.textContent = 'üòº Level 1: Find the No!';
      
      const description = document.createElement('p');
      description.className = 'level-description';
      description.innerHTML = 'Now try to find the <strong>No</strong> button among all these Yes buttons...<br>I dare you! üòà';
      
      const buttonGrid = document.createElement('div');
      buttonGrid.className = 'button-grid';
      
      // Create 30-40 Yes buttons and 1 No button
      const totalButtons = 35;
      const noPosition = Math.floor(Math.random() * totalButtons);
      
      for (let i = 0; i < totalButtons; i++) {
        const btn = document.createElement('button');
        btn.className = 'grid-button yes-button';
        
        if (i === noPosition) {
          btn.textContent = 'üíî No';
          btn.className = 'grid-button no-button';
          btn.onclick = () => onLevel1NoFound();
        } else {
          btn.textContent = 'üíö Yes';
          btn.onclick = () => answer(true);
        }
        
        buttonGrid.appendChild(btn);
      }
      
      content.appendChild(title);
      content.appendChild(description);
      content.appendChild(buttonGrid);
      levelScreen.appendChild(content);
      document.body.appendChild(levelScreen);
      
      launchConfetti();
    }

    // Level 1 No button found
    function onLevel1NoFound() {
      playErrorSound();
      createParticles(window.innerWidth / 2, window.innerHeight / 2, 30);
      
      const feedback = document.createElement('div');
      feedback.className = 'buffering-screen';
      feedback.innerHTML = `
        <div style="font-size: 3em;">üò±</div>
        <div style="margin-top: 20px;">You actually found it?!</div>
        <div style="margin-top: 10px; font-size: 0.9em;">Let's make this harder...</div>
      `;
      document.body.appendChild(feedback);
      
      setTimeout(() => {
        feedback.classList.add('fade-out');
        setTimeout(() => {
          feedback.remove();
          document.getElementById('level1-screen')?.remove();
          currentLevel++;
          levelNumber.textContent = currentLevel;
          startLevel(currentLevel);
        }, 500);
      }, 2500);
    }

    // Level 2: Moving target buttons
    function startLevel2() {
      const levelScreen = document.createElement('div');
      levelScreen.className = 'level-screen';
      levelScreen.id = 'level2-screen';
      
      const content = document.createElement('div');
      content.className = 'level-content';
      
      const title = document.createElement('h2');
      title.className = 'level-title';
      title.textContent = 'üéØ Level 2: Moving Target!';
      
      const description = document.createElement('p');
      description.className = 'level-description';
      description.innerHTML = 'The buttons are moving now!<br>Can you catch the <strong>No</strong>? üèÉ‚Äç‚ôÇÔ∏èüí®';
      
      content.appendChild(title);
      content.appendChild(description);
      levelScreen.appendChild(content);
      document.body.appendChild(levelScreen);
      
      // Create 10 moving buttons
      const numButtons = 10;
      const noPosition = Math.floor(Math.random() * numButtons);
      
      for (let i = 0; i < numButtons; i++) {
        const btn = document.createElement('button');
        btn.className = 'moving-button';
        
        // Random starting position
        const startX = Math.random() * (window.innerWidth - 150);
        const startY = Math.random() * (window.innerHeight - 100) + 100;
        
        btn.style.left = startX + 'px';
        btn.style.top = startY + 'px';
        
        // Set random movement variables
        btn.style.setProperty('--dx1', `${(Math.random() - 0.5) * 200}px`);
        btn.style.setProperty('--dy1', `${(Math.random() - 0.5) * 200}px`);
        btn.style.setProperty('--dx2', `${(Math.random() - 0.5) * 200}px`);
        btn.style.setProperty('--dy2', `${(Math.random() - 0.5) * 200}px`);
        btn.style.setProperty('--dx3', `${(Math.random() - 0.5) * 200}px`);
        btn.style.setProperty('--dy3', `${(Math.random() - 0.5) * 200}px`);
        
        if (i === noPosition) {
          btn.textContent = 'üíî No';
          btn.className += ' no-button';
          btn.onclick = () => onLevel2NoFound();
        } else {
          btn.textContent = 'üíö Yes';
          btn.className += ' yes-button';
          btn.onclick = () => answer(true);
        }
        
        document.body.appendChild(btn);
      }
    }

    // Level 2 No button found
    function onLevel2NoFound() {
      playErrorSound();
      createParticles(window.innerWidth / 2, window.innerHeight / 2, 30);
      
      // Remove all moving buttons
      document.querySelectorAll('.moving-button').forEach(btn => {
        btn.classList.add('fade-out');
        setTimeout(() => btn.remove(), 500);
      });
      
      const feedback = document.createElement('div');
      feedback.className = 'buffering-screen';
      feedback.innerHTML = `
        <div style="font-size: 3em;">ü§Ø</div>
        <div style="margin-top: 20px;">Okay, you're good!</div>
        <div style="margin-top: 10px; font-size: 0.9em;">But can you handle THIS?</div>
      `;
      document.body.appendChild(feedback);
      
      setTimeout(() => {
        feedback.classList.add('fade-out');
        setTimeout(() => {
          feedback.remove();
          document.getElementById('level2-screen')?.remove();
          currentLevel++;
          levelNumber.textContent = currentLevel;
          startLevel(currentLevel);
        }, 500);
      }, 2500);
    }

    // Level 3: Speed challenge - disappearing buttons
    function startLevel3() {
      const levelScreen = document.createElement('div');
      levelScreen.className = 'level-screen';
      levelScreen.id = 'level3-screen';
      
      const content = document.createElement('div');
      content.className = 'level-content';
      
      const title = document.createElement('h2');
      title.className = 'level-title';
      title.textContent = '‚ö° Level 3: Speed Run!';
      
      const description = document.createElement('p');
      description.className = 'level-description';
      description.innerHTML = 'The No buttons fade away quickly!<br>Click 5 of them before they disappear! ‚è±Ô∏è';
      
      const progressText = document.createElement('p');
      progressText.id = 'level3-progress';
      progressText.style.fontSize = '1.5em';
      progressText.style.fontWeight = 'bold';
      progressText.style.color = '#ff1493';
      progressText.style.marginTop = '20px';
      progressText.textContent = 'Found: 0/5';
      
      content.appendChild(title);
      content.appendChild(description);
      content.appendChild(progressText);
      levelScreen.appendChild(content);
      document.body.appendChild(levelScreen);
      
      let foundCount = 0;
      const targetCount = 5;
      
      function spawnSpeedButton() {
        if (foundCount >= targetCount) return;
        
        const btn = document.createElement('button');
        btn.className = 'speed-button no-button';
        btn.textContent = 'üíî No';
        btn.style.position = 'fixed';
        btn.style.zIndex = '1850';
        
        const x = Math.random() * (window.innerWidth - 150);
        const y = Math.random() * (window.innerHeight - 100) + 100;
        
        btn.style.left = x + 'px';
        btn.style.top = y + 'px';
        
        btn.onclick = () => {
          foundCount++;
          playErrorSound();
          createParticles(x + 60, y + 30, 15);
          btn.classList.add('fade-out');
          setTimeout(() => btn.remove(), 500);
          
          document.getElementById('level3-progress').textContent = `Found: ${foundCount}/${targetCount}`;
          
          if (foundCount >= targetCount) {
            onLevel3Complete();
          }
        };
        
        document.body.appendChild(btn);
        
        // Button disappears after 2 seconds
        setTimeout(() => {
          if (document.body.contains(btn)) {
            btn.classList.add('fade-out');
            setTimeout(() => btn.remove(), 500);
          }
        }, 2000);
      }
      
      // Spawn buttons continuously
      const spawnInterval = setInterval(() => {
        if (foundCount >= targetCount) {
          clearInterval(spawnInterval);
        } else {
          spawnSpeedButton();
        }
      }, 1000);
      
      // Initial spawn
      spawnSpeedButton();
    }

    // Level 3 complete
    function onLevel3Complete() {
      playErrorSound();
      
      // Remove all speed buttons
      document.querySelectorAll('.speed-button').forEach(btn => {
        btn.classList.add('fade-out');
        setTimeout(() => btn.remove(), 500);
      });
      
      const feedback = document.createElement('div');
      feedback.className = 'buffering-screen';
      feedback.innerHTML = `
        <div style="font-size: 3em;">üò§</div>
        <div style="margin-top: 20px;">FINE! You win!</div>
        <div style="margin-top: 10px; font-size: 0.9em;">I guess there's only one option left...</div>
      `;
      document.body.appendChild(feedback);
      
      setTimeout(() => {
        feedback.classList.add('fade-out');
        setTimeout(() => {
          feedback.remove();
          document.getElementById('level3-screen')?.remove();
          showFinalChoice();
        }, 500);
      }, 3000);
    }

    // Show final choice - only Yes buttons
    function showFinalChoice() {
      document.getElementById('main-content').style.display = 'block';
      levelIndicator.style.display = 'none';
      
      const qDiv = document.getElementById('valentine-question');
      qDiv.innerHTML = `
        <h1>üíù Will You Be My Valentine? üíù</h1>
        <p style="font-size: 1.2em; color: #333; margin: 20px 0;">After all that... you know the answer üòä</p>
        <div id="button-container">
          <button class="yes-button" onclick="answer(true)">üíö Yes!</button>
          <button class="yes-button" onclick="answer(true)">üíö Absolutely Yes!</button>
        </div>
      `;
      qDiv.style.display = 'block';
      
      launchConfetti();
    }

    // Show success screen
    function showSuccess() {
      document.getElementById('valentine-question').style.display = 'none';
      document.getElementById('main-content').style.display = 'none';
      attemptCounter.style.display = 'none';
      shakePrompt.style.display = 'none';
      levelIndicator.style.display = 'none';
      
      // Remove any level screens
      document.querySelectorAll('.level-screen').forEach(screen => screen.remove());
      
      const successScreen = document.createElement('div');
      successScreen.className = 'success-screen';
      successScreen.innerHTML = `
        <h1>üéâ Success! üéâ</h1>
        <p>Congratulations, ${userName}!</p>
        <p>You've just won the ultimate prize:</p>
        <p style="font-size: 1.5em; color: #ff1493; font-weight: bold;">Being My Valentine! üíù</p>
        <img src="gif.gif" alt="Success" class="success-gif" />
        <p style="margin-top: 20px; font-size: 0.9em;">Thank you for making my day special! ‚ú®</p>
        ${currentLevel > 0 ? `<p style="margin-top: 10px; font-size: 0.8em; color: #666;">You completed ${currentLevel} level${currentLevel > 1 ? 's' : ''}! üèÜ</p>` : ''}
      `;
      
      document.body.appendChild(successScreen);
      
      // Play success sound
      const successSound = new Audio('success.mp3');
      successSound.volume = 0.8;
      successSound.play().catch(err => console.log('Success sound failed:', err));
      
      // Stop background music
      backgroundMusic.pause();
      isMusicPlaying = false;
      document.getElementById('music-btn').textContent = 'üîá';
      
      // Epic confetti celebration
      launchConfetti();
      setTimeout(() => launchConfetti(), 1000);
      setTimeout(() => launchConfetti(), 2000);
      setTimeout(() => launchConfetti(), 3000);
    }

    // Toggle background music
    function toggleMusic() {
      if (isMusicPlaying) {
        backgroundMusic.pause();
        isMusicPlaying = false;
        document.getElementById('music-btn').textContent = 'üîá';
      } else {
        backgroundMusic.play().then(() => {
          isMusicPlaying = true;
          document.getElementById('music-btn').textContent = 'üîä';
        }).catch(err => {
          console.log('Toggle music failed:', err);
          alert('Please interact with the page first to enable audio!');
        });
      }
    }

    // Shake detection for mobile devices
    function enableShakeDetection() {
      if (!shakeDetectionEnabled && window.DeviceMotionEvent) {
        let lastX, lastY, lastZ;
        let lastTime = Date.now();
        
        window.addEventListener('devicemotion', (e) => {
          const acc = e.accelerationIncludingGravity;
          const currentTime = Date.now();
          
          if ((currentTime - lastTime) > 100) {
            const deltaTime = currentTime - lastTime;
            lastTime = currentTime;
            
            if (lastX !== undefined) {
              const deltaX = Math.abs(acc.x - lastX);
              const deltaY = Math.abs(acc.y - lastY);
              const deltaZ = Math.abs(acc.z - lastZ);
              
              // Detect shake
              if ((deltaX + deltaY + deltaZ) / deltaTime * 10000 > 150) {
                onShakeDetected();
              }
            }
            
            lastX = acc.x;
            lastY = acc.y;
            lastZ = acc.z;
          }
        });
        
        shakeDetectionEnabled = true;
      }
    }

    // Handle shake event
    function onShakeDetected() {
      if (noAttempts > 0 && noAttempts < 5) {
        createParticles(window.innerWidth / 2, window.innerHeight / 2, 30);
        
        // Spawn multiple No buttons
        for (let i = 0; i < 3; i++) {
          setTimeout(() => spawnNoButton(), i * 200);
        }
        
        // Show feedback
        const feedback = document.createElement('div');
        feedback.style.cssText = `
          position: fixed;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          background: rgba(255, 255, 255, 0.95);
          padding: 20px 40px;
          border-radius: 15px;
          font-size: 1.2em;
          color: #ff1493;
          font-weight: bold;
          z-index: 1800;
          box-shadow: 0 10px 30px rgba(0,0,0,0.3);
          animation: successPop 0.5s ease;
        `;
        feedback.textContent = 'üì± Shake detected! More buttons spawned!';
        document.body.appendChild(feedback);
        
        setTimeout(() => {
          feedback.classList.add('fade-out');
          setTimeout(() => feedback.remove(), 500);
        }, 2000);
      }
    }

    // Prevent zoom on double tap (iOS)
    let lastTouchEnd = 0;
    document.addEventListener('touchend', (e) => {
      const now = Date.now();
      if (now - lastTouchEnd <= 300) {
        e.preventDefault();
      }
      lastTouchEnd = now;
    }, false);

    // Add click particle effects to all buttons
    document.addEventListener('click', (e) => {
      if (e.target.tagName === 'BUTTON') {
        createParticles(e.clientX, e.clientY, 10);
      }
    });

    // Console easter egg
    console.log('%cüíù Happy Valentine\'s Day! üíù', 'font-size: 24px; color: #ff1493; font-weight: bold;');
    console.log('%cMade with ‚ù§Ô∏è for someone special', 'font-size: 16px; color: #ff69b4;');
    console.log('%c3 levels of playful challenges await! üòº', 'font-size: 14px; color: #ff69b4;');
  </script>
</body>
</html>